!function(t,e){if("function"==typeof define&&define.amd)define("cestino/BasicCartService",["bluebird/js/browser/bluebird.min","atomic/dist/atomic.min"],e);else if("object"==typeof module&&module.exports)module.exports=e(require("bluebird"),require("atomic"));else{t.Cestino=t.Cestino||{};t.Cestino.BasicCartService=e(t.Promise,t.atomic)}}(this,function(t,o){"use strict";var i={url:""};"undefined"!=typeof window&&(window.Promise=window.Promise||t);e.prototype={setProductDataToCart:function(i){var n=this,r={};i.walk(function(t){r[t.getProduct().getId()]=t.getFeatures().map(function(t){return t.getId()})});return new t(function(e,t){o(n[" options"].url,{method:"POST",data:r}).catch(t).then(function(t){(function(r,o){o.walk(function(t){var i,e,n=[];if(t.getProduct().getId()in r){i=r[t.getProduct().getId()];t.getProduct()[" title"]=i.title;t.getProduct()[" price"]=i.price;t.getFeatures().forEach(function(t,e){if(t.getId()in i.features){t[" label"]=i.features[t.getId()].label;t[" price"]=i.features[t.getId()].price}else n.push(e)});e=n.pop();for(;e;){t[" features"].splice(e,1)[0];e=n.pop()}}else o.deletePosition(t.getId())})}).call(n,t.data,i);e(t.data)})})}};function e(t){var e;this[" options"]=JSON.parse(JSON.stringify(i));for(e in t)this[" options"][e]=t[e]}return{create:function(t){return new e(t)}}});!function(t,e){if("function"==typeof define&&define.amd)define("cestino/Util",e);else if("object"==typeof module&&module.exports)module.exports=e();else{t.Cestino=t.Cestino||{};t.Cestino.Util=e()}}(this,function(){"use strict";function n(t){return t===+t&&t===(0|t)}return{isInt:n,isEmpty:function(t){return!t||"0"===t},lpad:function(t,e,i){if(!n(e))throw new TypeError("Parameter width has to be an int!");if((t+="").length>=e)return t;i=i||"0";i+="";return new Array(Math.ceil((e-t.length)/i.length)+1).join(i).slice(0,e-t.length)+t}}});!function(t,e){if("function"==typeof define&&define.amd)define("cestino/PriceFormatter",["cestino/Util"],e);else if("object"==typeof module&&module.exports)module.exports=e(require("./Util"));else{t.Cestino=t.Cestino||{};t.Cestino.PriceFormatter=e(t.Cestino.Util)}}(this,function(o){"use strict";function n(t,e,i){e=e||"";if(-1===[2,3].indexOf(i=i||2))throw new RangeError("The decimal count has to be 2 or 3!");if(-1===[".",",","Ù«"].indexOf(t))throw new RangeError(['"',t,'" is not a typical decimal seperator'].join(""));this[" decimalCount"]=i;this[" thousandsSeperator"]=e;this[" decimalSeperator"]=t}n.prototype={format:function(t){if(!o.isInt(t))throw new TypeError("Parameter int has to be an Int!");return[function(t,e){var i,n,r;t+="";if(!o.isInt(e))throw new TypeError("Parameter size has to be an Int!");i=Math.ceil(t.length/e);n=t.length%e||e;r=new Array(i);for(;0<--i;)r[i]=t.substr((i-1)*e+n,e);r[0]=t.substr(0,n);return r}(parseInt((t+"").slice(0,-1*this[" decimalCount"])),3).join(this[" thousandsSeperator"]),this[" decimalSeperator"],o.lpad(t%Math.pow(10,this[" decimalCount"]),this[" decimalCount"])].join("")}};return{create:function(t,e,i){return new n(t,e,i)}}});!function(t,e){"function"==typeof define&&define.amd?define("cestino/Cart",["cestino/Util","cestino/BasicCartService","cestino/PriceFormatter"],e):"object"==typeof module&&module.exports?module.exports=e(require("./Util"),require("./BasicCartService"),require("./PriceFormatter")):t.Cestino=e(t.Cestino.Util,t.Cestino.BasicCartService,t.Cestino.PriceFormatter)}(this,function(u,e,t){"use strict";var s="__INCOMPLETE__",o=["load","add","change","remove"];a.prototype={add:function(t,e,i,n){e=e||new a.ProductQuantity(1);var r,o,s="g"+(i=h.call(this,i)||new a.ShippingGroup(i)).getName();n=n||[];if(!(t instanceof a.Product))throw new TypeError("The product has to be a instance of Cart.Product!");u.isInt(e)&&(e=new a.ProductQuantity(e));if(!(e instanceof a.ProductQuantity))throw new TypeError(["The quantity has to be a instance of Cart.ProductQuantity or a positive ","integer value!"].join(""));(i[" cart"]=this)[" shippingGroups"][s]=i;this[" positions"][s]=this[" positions"][s]||[];r="p"+this[" positionId"]++;((o=new c(r,t,n,e))[" cart"]=this)[" positions"][s].push(o);p.call(this,"add",o);return r},on:function(t,e){if("function"!=typeof e)throw new TypeError("The passed listener has to be a function!");if(-1===o.indexOf(t))throw new TypeError(t+" is an unknown event! Try one of these: "+o.join(", ")+".");this[" listener"][t].push(e);return this},off:function(i,n){var r=this;if(-1===o.indexOf(i))throw new TypeError(i+" is an unknown event! Try one of these: "+o.join(", ")+".");this[" listener"][i].some(function(t,e){if(n===t){r[" listener"][i].splice(e,1);return!0}});return this},calculateGroup:d,calculate:function(e){var i=this,n=0;e=e||!1;r.call(this).forEach(function(t){n+=d.call(i,t,e)});return n},deletePosition:function(t){var e,i=n.call(this,t);if(!i)throw new RefereneceError(["No position with id '",t,"' found!"].join(""));e=this[" positions"][i.group].splice(i.index,1)[0];p.call(this,"remove",e);return e},getShippingGroupByName:h,getPositionsOfGroup:function(t){var e=f.call(this,t);if(e in this[" positions"])return this[" positions"][e];throw new ReferenceError(["No shipping-group with name '",t,"' found!"].join(""))},getShippingGroups:r,getPositionById:function(t){var e=n.call(this,t);if(e)return this[" positions"][e.group][e.index];throw new ReferenceError(["No position with id '",t,"' found!"].join(""))},toJSON:function(){var i={date:(new Date).toISOString(),AutoPosId:this[" positionId"],pos:{}};this.walk(function(t,e){i.pos[e]=i.pos[e]||[];i.pos[e].push({id:t.getId(),product:{id:t.getProduct().getId()},quantity:{amount:t.getQuantity().getAmount(),dimX:t.getQuantity().getWidth(),dimY:t.getQuantity().getHeight(),dimZ:t.getQuantity().getDepth()},features:t.getFeatures().map(function(t){return t.getId()})})});return JSON.stringify(i)},fromJSON:function(t){var e,i,n,r,o=this;if(0!==Object.keys(this[" positions"]).length)throw new RangeError("Cart has to be empty when loading from a JSON!");e=JSON.parse(t);this[" positionId"]=e.AutoPosId;Object.keys(e.pos).forEach(function(t){r="g"+t;((n=new a.ShippingGroup(t))[" cart"]=o)[" shippingGroups"][r]=n;e.pos[t].forEach(function(t){((i=new c(t.id,new a.Product(t.product.id,s,987654321),t.features.map(function(t){return new a.ProductFeature(t,s,987654321)}),new a.ProductQuantity(t.quantity.amount,t.quantity.dimX,t.quantity.dimY,t.quantity.dimZ)))[" cart"]=o)[" positions"][r]=o[" positions"][r]||[];o[" positions"][r].push(i)})});this[" oCartService"].setProductDataToCart(this).then(function(){o[" listener"].load.forEach(function(t){t(o)})});return this},walk:function(i){var t=this;this.getShippingGroups().forEach(function(e){t.getPositionsOfGroup(e).forEach(function(t){i(t,e)})});return this}};function a(t){if("function"!=typeof(t=t||e.create()).setProductDataToCart)throw new TypeError(["The service has to be able to find Products! ","\n",'Implement a function named "setProductDataToCart" that takes one argument of type ',"Object. ","\n","The keys of the object has to represent product-ids, the ","values has to be arrays of selected product-feature-ids."].join(""));this[" positionId"]=1;this[" oCartService"]=t;this[" positions"]={};this[" shippingGroups"]={};this[" listener"]={add:[],remove:[],change:[],load:[]}}function c(t,e,i,n){this[" id"]=t;this[" product"]=e;this[" features"]=i;this[" quantity"]=n;this[" cart"]=null}(c.prototype={calculate:function(){var e=0;this[" features"].forEach(function(t){e+=t.getPrice()});return(this[" product"].getPrice()+e)*this[" quantity"].getFactor()},incrementAmount:function(t){t=t||1;if(!u.isInt(t))throw new TypeError("Amount has to be of type integer!");this[" quantity"][" amount"]+=t;p.call(this[" cart"],"change",this);return this},decrementAmount:function(t){t=t||1;if(!u.isInt(t))throw new TypeError("Amount has to be of type integer!");this[" quantity"][" amount"]-=t;p.call(this[" cart"],"change",this);return this},replaceQuantity:function(t){if(!(t instanceof a.ProductQuantity))throw new TypeError("The quantity has to be a instance of Cart.ProductQuantity!");this[" quantity"]=t;p.call(this[" cart"],"change",this);return this}}).getId=function(){return this[" id"]};c.prototype.getProduct=function(){return this[" product"]};c.prototype.getFeatures=function(){return this[" features"]};c.prototype.getQuantity=function(){return this[" quantity"]};c.prototype.getCart=function(){return this[" cart"]};(a.Product=function(t,e,i){if(u.isEmpty(t)||"string"!=typeof t&&!u.isInt(t))throw new RangeError("The product has to have an id of type string or integer!");if(u.isEmpty(e)||"string"!=typeof e)throw new RangeError("The product has to have a title of type string!");if(!u.isInt(i)||i<0)throw new TypeError("The price has to be an positive integer!");this[" id"]=t;this[" title"]=e;this[" price"]=i}).prototype.getId=function(){return this[" id"]};a.Product.prototype.getTitle=function(){return this[" title"]};a.Product.prototype.getPrice=function(){return this[" price"]};(a.ProductQuantity=function(t,e,i,n){this[" amount"]=t;this[" dimensionX"]=e||1;this[" dimensionY"]=i||1;this[" dimensionZ"]=n||1;if(!(u.isInt(this[" amount"])&&u.isInt(this[" dimensionX"])&&u.isInt(this[" dimensionY"])&&u.isInt(this[" dimensionZ"])))throw new TypeError(["Invalid try to instanciate quantity. Not all parameters are integers! ","\ndata object: ",JSON.stringify(this),"\n"].join(""))}).prototype.getAmount=function(){return this[" amount"]};a.ProductQuantity.prototype.getLength=function(){return this[" dimensionX"]};a.ProductQuantity.prototype.getWidth=function(){return this[" dimensionX"]};a.ProductQuantity.prototype.getHeight=function(){return this[" dimensionY"]};a.ProductQuantity.prototype.getDepth=function(){return this[" dimensionZ"]};a.ProductQuantity.prototype.getFactor=function(){return this.getAmount()*this.getWidth()*this.getHeight()*this.getDepth()};(a.ProductFeature=function(t,e,i){i=i||0;if(u.isEmpty(t)||"string"!=typeof t&&!u.isInt(t))throw new RangeError("The product feature has to have an id of type string or integer!");if(u.isEmpty(e)||"string"!=typeof e)throw new RangeError("The product feature has to have a title of type string!");if(!u.isInt(i)||i<0)throw new TypeError("The price has to be an positive integer!");this[" id"]=t;this[" price"]=i;this[" label"]=e}).prototype.getId=function(){return this[" id"]};a.ProductFeature.prototype.getPrice=function(){return this[" price"]};a.ProductFeature.prototype.getLabel=function(){return this[" label"]};(a.ShippingGroup=function(t){this[" name"]=t||"";this[" cart"]=null;this[" price"]=0}).prototype.calculate=function(){return d.call(this.getCart(),this.getName(),includeShippingGroupCost||!0)};a.ShippingGroup.prototype.setPrice=function(t){if(!u.isInt(t)||t<0)throw new TypeError("The price has to be an positive integer!");this[" price"]=t;return this};a.ShippingGroup.prototype.getPrice=function(){return this[" price"]};a.ShippingGroup.prototype.getName=function(){return this[" name"]};a.ShippingGroup.prototype.getCart=function(){return this[" cart"]};function p(t,e){this[" listener"][t].forEach(function(t){t(e)})}function r(){return Object.keys(this[" positions"]).map(function(t){return t.substr(1)})}function h(t){var e=t instanceof a.ShippingGroup,i="g"+(e&&t.getName()||t||"");return i in this[" shippingGroups"]&&this[" shippingGroups"][i]||e&&t||!1}function f(t){return"g"+(t instanceof a.ShippingGroup&&t.getName()||t||"")}function d(t,e){var i=0,n=(e=e||!1,f.call(this,t));this.getPositionsOfGroup(t).forEach(function(t){i+=t.calculate()});return i+(e&&this[" shippingGroups"][n].getPrice()||0)}function n(n){var t=this[" positions"],r=!1;Object.keys(t).some(function(i){t[i].some(function(t,e){t.getId()===n&&(r={group:i,index:e});return!!r});return!!r});return r}function i(e){var t,i=this,n=e.prototype;e.prototype=Object.create(this.prototype);(e.prototype.constructor=e).prototype.getSuperMethod=function(t){return this.__proto__.__proto__.bind(this)};for(t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e.prototype[t]=n[t]);return{create:function(){var t=Object.create(e.prototype);i.apply(t,arguments);e.apply(t,arguments);return t}}}function l(t){return function(){return new a[t](void 0!==arguments[0]&&arguments[0]||void 0,void 0!==arguments[1]&&arguments[1]||void 0,void 0!==arguments[2]&&arguments[2]||void 0,void 0!==arguments[3]&&arguments[3]||void 0)}}return{create:function(t){return new a(t)},Util:u,PriceFormatter:t,BasicCartService:e,Product:{create:l("Product"),extendWith:i.bind(a.Product)},ProductFeature:{create:l("ProductFeature"),extendWith:i.bind(a.ProductFeature)},ProductQuantity:{create:l("ProductQuantity"),extendWith:i.bind(a.ProductQuantity)},ShippingGroup:{create:l("ShippingGroup"),extendWith:i.bind(a.ShippingGroup)}}});"function"==typeof define&&define.amd&&define(["cestino/Cart"],function(t){return t});